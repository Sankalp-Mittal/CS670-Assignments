version: "3.9"

services:
  gen:
    build: .
    image: mpc:latest
    container_name: gen
    # run generator directly; pass your args (positionals + optional flags)
    entrypoint: ["/app/gen_queries"]
    command: ["10", "10", "5", "1", "--seed=42", "--debug"]
    volumes:
      - ./mpc_data:/data
    networks: [mpc_net]
    restart: "no"

  p2:
    build: .
    image: mpc:latest
    container_name: p2
    environment: [ROLE=p2]
    depends_on:
      gen:
        condition: service_completed_successfully   # wait until gen exits 0
    volumes:
      - ./mpc_data:/data
    networks: [mpc_net]
    restart: unless-stopped

  p0:
    build: .
    image: mpc:latest
    container_name: p0
    environment: [ROLE=p0]
    depends_on:
      - p2
      - p1              
    volumes:
      - ./mpc_data:/data
    networks: [mpc_net]
    restart: "no"

  p1:
    build: .
    image: mpc:latest
    container_name: p1
    environment: [ROLE=p1]
    depends_on:
      - p2
    volumes:
      - ./mpc_data:/data
    networks: [mpc_net]
    restart: "no"

networks:
  mpc_net:
    driver: bridge
